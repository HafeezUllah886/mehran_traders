<?php
 namespace App\Http\Controllers\reports; use App\Http\Controllers\Controller; use App\Models\accounts; use App\Models\sales; use App\Models\User; use Illuminate\Http\Request; class salesReportController extends Controller { public function index() { $orderbookers = User::where("\x72\x6f\154\x65", "\x4f\162\144\145\162\142\157\157\153\x65\x72")->get(); return view("\x72\145\160\157\x72\164\163\56\163\141\x6c\145\163\56\151\x6e\144\145\170", compact("\157\162\x64\x65\162\x62\x6f\x6f\153\145\162\x73")); } public function data($from, $to, $type, $orderbooker) { $sales = sales::with("\x63\x75\x73\x74\x6f\x6d\x65\x72", "\x64\x65\x74\141\x69\x6c\163")->whereBetween("\144\141\164\x65", array($from, $to)); if ($type != "\101\x6c\x6c") { $customers = accounts::where("\164\x79\x70\x65", "\103\x75\x73\164\157\x6d\x65\162")->where("\x63\x5f\x74\x79\160\x65", $type)->pluck("\151\144")->toArray(); $sales->whereIn("\x63\165\163\x74\157\155\x65\162\111\x44", $customers); } if ($orderbooker != "\x41\x6c\x6c") { $sales->where("\x6f\x72\x64\x65\x72\x62\157\x6f\x6b\x65\x72\111\104", $orderbooker); } $sales = $sales->get(); foreach ($sales as $sale) { $pdiscount = 0; foreach ($sale->details as $detail) { $pdiscount += $detail->discount * $detail->qty; } $sale->pdiscount = $pdiscount; } return view("\162\145\x70\x6f\x72\164\x73\56\163\x61\x6c\145\x73\x2e\144\x65\x74\141\151\154\163", compact("\x66\x72\x6f\x6d", "\x74\x6f", "\163\141\154\x65\163")); } }