<?php
 namespace App\Http\Controllers\reports; use App\Http\Controllers\Controller; use App\Models\accounts; use App\Models\categories; use App\Models\products; use App\Models\purchase; use App\Models\purchase_details; use Illuminate\Http\Request; class purchaseProductsReportController extends Controller { public function index() { $categories = categories::all(); $vendors = accounts::where("\164\171\x70\x65", "\x56\145\156\x64\157\x72")->get(); return view("\162\x65\x70\157\162\x74\x73\56\x70\165\162\143\x68\141\x73\x65\x50\162\157\x64\x75\x63\164\163\x2e\151\x6e\144\x65\x78", compact("\143\x61\164\145\x67\157\x72\151\x65\163", "\166\x65\156\144\157\x72\163")); } public function data($from, $to, $catID, $vendor) { if ($catID == "\101\x6c\x6c") { $products = products::all(); } else { $products = products::where("\x63\141\164\x49\x44", $catID)->get(); } $purchases = purchase::whereBetween("\144\141\164\x65", array($from, $to)); if ($vendor != "\101\154\154") { $purchases->where("\x76\145\x6e\x64\157\x72\111\104", $vendor); } $purchases = $purchases->pluck("\151\x64"); foreach ($products as $product) { $purchase_details = purchase_details::whereIn("\x70\x75\162\143\x68\x61\163\145\x49\104", $purchases)->where("\x70\162\x6f\144\165\x63\164\x49\104", $product->id)->get(); $qty = $purchase_details->sum("\x71\x74\x79"); $bonus = $purchase_details->sum("\x62\157\x6e\x75\x73"); $product->qty = $qty; $product->bonus = $bonus; $product->price = avgPurchasePrice($from, $to, $product->id); } return view("\162\x65\x70\x6f\x72\x74\163\x2e\x70\x75\x72\x63\x68\x61\x73\145\x50\x72\x6f\144\165\x63\x74\x73\56\x64\x65\164\x61\151\x6c\x73", compact("\146\x72\x6f\155", "\x74\157", "\x70\162\157\x64\165\x63\164\163")); } }